# Snake Game 要件（タイムアタック版）

最終更新: 2025-08-11

## 1. 概要
- 静的HTMLのみで動作するスネークゲーム。
- **目標スコア 1000点**のタイムアタック。
- ゲーム外（開始前）で初期スピードを **10〜200** から選択（`localStorage.snakeBaseSpeed` に保存）。
- プレイ中のスピード変化は **一時効果（3秒）**。終了後は初期スピードへ戻る。

## 2. UI / 操作
- **Start / Restart** ボタン（ポーズ無し）。
- **方向キー / WASD** 操作。
- **キャンバスのタップ/クリック**：ヘビ頭と入力位置の相対から進行方向を自動判定。
- **オンスクリーンDパッド**（▲◀▶▼）で操作可能（PCクリックも可）。
- グリッド表示のトグルあり。
- ステータス表示：スコア（`/ 1000`）、ゲームタイマー、効果タイマー、状態（Ready/Playing/Win/Game Over）、現在スピード。
- 追加ボタン：
  - **🧹 記録クリア**：ローカル記録を一括削除
  - **📜 最近のスコア**：ローカル履歴一覧（新しい順）
  - **🏆 ベスト10**：ローカルの上位10件（スコア降順、同点は時間短い順）

## 3. スピード仕様
- 初期スピード（選択）：**10〜200**（10刻み）、デフォルト100。
- 一時効果：**3秒間**の効果。
  - **青餌（スピードダウン）**：「50ダウン」または「半減」のうち、減少量が少ないほう
  - **赤餌（スピードアップ）**：「50アップ」または「2倍」のうち、上昇量が少ないほう
- 効果後は選択した初期スピードへ復帰。
- 実行速度クランプ：**10〜1000** の範囲に制限。
- スピードは「10秒あたりのマス進行数」。移動は `step = 10000 / speed` ms ごと。

## 4. フード仕様（最低構成を維持）
- 盤上フードの**最低構成**を常時維持：
  - **通常**：最低 **5個**
  - **スピードアップ（赤餌）**：最低 **2個**（効果：50アップまたは2倍のうち上昇量が少ないほう、3秒）
  - **スピードダウン（青餌）**：最低 **2個**（効果：50ダウンまたは半減のうち減少量が少ないほう、3秒）
- 初期配置は上記より多めに生成（例：通常10/速3/遅3）。取得時は同種を補充し、**下限数**を満たすよう維持。

## 5. スコア
- 通常：**+20点**
- スピードアップ：**+50点**
- スピードダウン：**+30点**
- **1000点達成で勝利**（🎉表示）。壁衝突/自滅でゲームオーバー。

## 6. タイマー
- **ゲームタイマー**：`performance.now()` ベースの実時間計測（ループ速度と独立）。
- **効果タイマー**：発動中のみ残り秒数を表示（最大3.0s）。

## 7. 当たり判定と移動
- 壁衝突・自己衝突でゲームオーバー。
- **180度反転は禁止**（誤操作防止）。
- 1ステップ＝1マス。

## 8. ゲーム開始フロー
- **Start / Restart** 後は「Ready — 操作で開始」。
- 最初の入力（キーボード／Dパッド／キャンバスのタップ・クリック）で**その方向に動き出し**、同時に**ゲームタイマー開始**。

## 9. 永続化（ローカルのみ）
- 初期スピード：`snakeBaseSpeed`
- ベストスコア：`snakeBestScore`
- 最速1000点タイム（ms）：`snakeBestTimeMs`（0は未記録）
- 直近記録リスト：`snakeRecords`（`[{score,timeMs,win,at}, ...]`）
- 「記録クリア」ボタンで上記を一括削除。

## 10. 画面要素
- ヘッダ：タイトル、初期スピードセレクタ、現在スピードバッジ。
- 情報パネル：ベストスコア、最速1000点タイム、スコア、ゲームタイマー、効果タイマー、状態。
- キャンバス（21×13マス想定、レスポンシブ）。
- Dパッド、操作ボタン群、グリッド表示トグル、操作ヒント。

## 11. 実装メモ
- タイマーは `performance.now()` による**実時間**管理。
- 1000点到達時は**経過時間を記録**し、**最速タイム**を更新。
- 記録一覧とベスト10はローカル履歴から即時集計・表示。

